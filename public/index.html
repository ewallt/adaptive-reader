<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adaptive Reader</title>
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script src="https://www.blueletterbible.org/scripts/blbToolTip/BLB_ScriptTagger-min.js"></script>
    <script>
        /* keep dark-mode utilities working */
        tailwind.config = { darkMode: 'class' };
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Source+Sans+3:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
    <style>
        /* Custom font families for the themes */
        .font-newspaper { font-family: 'Lora', serif; }
        .font-dark-theme { font-family: 'Source Sans 3', sans-serif; }

        /* Base styles */
        body {
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Light theme (Newspaper) styles */
        .newspaper-theme {
            background-color: #fdfdfd;
            color: #1a1a1a;
        }
        .newspaper-theme strong {
            font-weight: 600;
        }
        .newspaper-theme .author-nav button {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            color: #212529;
        }
        .newspaper-theme .author-nav button:hover {
            background-color: #e9ecef;
        }
        .newspaper-theme .author-nav button.active {
            background-color: #1a1a1a;
            color: #fdfdfd;
        }

        /* Dark theme styles */
        .dark-theme {
            background-color: #2d2d30;
            color: #ffffff;
        }
        .dark-theme .card {
            background-color: #3c3c3c;
            border-color: #4a4a4a;
        }
        .dark-theme ul {
            list-style-type: disc;
            list-style-position: inside;
        }
        .dark-theme li::marker {
            color: #888888;
        }
        .dark-theme .author-nav button {
            background-color: #3c3c3c;
            border: 1px solid #4a4a4a;
            color: #cccccc;
        }
        .dark-theme .author-nav button:hover {
            background-color: #4a4a4a;
        }
        .dark-theme .author-nav button.active {
            background-color: #ffffff;
            color: #2d2d30;
        }

        /* Shared styles */
        .author-nav {
            margin-bottom: 2rem;
        }
        .author-nav button {
            padding: 0.5rem 1rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            border-radius: 0.375rem;
            transition: all 0.2s ease;
            cursor: pointer;
        }
    </style>
</head>
<body class="font-newspaper newspaper-theme">

    <div class="fixed top-4 right-4 z-50">
        <button id="theme-switcher" class="p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors duration-300">
            <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M12 12a5 5 0 100-10 5 5 0 000 10z" />
            </svg>
            <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
            </svg>
        </button>
    </div>

    <article id="content-container"
             class="prose dark:prose-invert mx-auto max-w-prose p-8"></article>

    <script>
        // State variables to hold the application's data and selections
        let appData = null;
        let currentCategory = null;
        const contentContainer = document.getElementById('content-container');

        /**
         * Builds the category navigation HTML string
         */
        function buildCategoryNav() {
            if (!appData) return '';
            const categories = appData.categories;
            let navHtml = '<div class="author-nav">';
            navHtml += '<h3>Select Category:</h3>';
            
            for (const categoryKey in categories) {
                const category = categories[categoryKey];
                const isActive = categoryKey === currentCategory ? 'active' : '';
                navHtml += `<button class="author-btn ${isActive}" data-category="${categoryKey}">${category.display_name}</button>`;
                
                if (category.breakAfter) {
                    navHtml += '<br>';
                }
            }
            
            navHtml += '</div>';
            return navHtml;
        }

        /**
         * Renders the complete content for the current category
         */
        function renderContent() {
            if (!appData) return;
            const category = appData.categories[currentCategory];
            let html = '';
            
            // Main title and description
            html += `<h1>${appData.title}</h1>`;
            html += `<p>${appData.description}</p>`;
            
            // Category navigation
            html += buildCategoryNav();
            
            // Category name and introduction
            html += `<h2>${category.name}</h2>`;
            html += `<p>${category.introduction}</p>`;
            
            // Paragraphs
            if (category.paragraphs && category.paragraphs.length > 0) {
                category.paragraphs.forEach(paragraph => {
                    if (paragraph.heading) {
                        html += `<h3>${paragraph.heading}</h3>`;
                    }
                    html += `<p>${paragraph.content}</p>`;
                });
            }
            
            contentContainer.innerHTML = html;
            
            // Re-add event listeners to the new category buttons
            document.querySelectorAll('.author-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const selectedCategory = e.target.dataset.category;
                    if (selectedCategory !== currentCategory) {
                        currentCategory = selectedCategory;
                        renderContent(); // Re-render with the new selection
                    }
                });
            });
        }
        
        /**
         * Fetches data, initializes the app state, and triggers the first render
         */
        async function initializeApp() {
            try {
                const response = await fetch('./data/content.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                appData = await response.json();
                
                // Set the initial category to the first one in the data
                currentCategory = Object.keys(appData.categories)[0];
                
                // Set the page title
                document.title = appData.title;
                
                // Render the content for the first time
                renderContent();

            } catch (error) {
                console.error('Failed to load or render content:', error);
                contentContainer.innerHTML = `<h1>Error</h1><p>Could not load content from <code>/data/content.json</code>. Please check the console for details.</p>`;
            }
        }


        // --- Theme Switcher Logic ---
        const themeSwitcher = document.getElementById('theme-switcher');
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');
        const body = document.body;

        function applyTheme(theme) {
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
                body.classList.remove('newspaper-theme', 'font-newspaper');
                body.classList.add('dark-theme', 'font-dark-theme');
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
                themeSwitcher.style.color = '#cccccc';
            } else {
                document.documentElement.classList.remove('dark');
                body.classList.remove('dark-theme', 'font-dark-theme');
                body.classList.add('newspaper-theme', 'font-newspaper');
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
                themeSwitcher.style.color = '#1a1a1a';
            }
        }

        themeSwitcher.addEventListener('click', () => {
            const currentTheme = localStorage.getItem('theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            localStorage.setItem('theme', newTheme);
            applyTheme(newTheme);
        });

        // On page load, apply the saved theme and then initialize the app content
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            applyTheme(savedTheme);
            initializeApp();
        });

    </script>
</body>
</html>